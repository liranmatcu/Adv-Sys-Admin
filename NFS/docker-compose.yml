version: "3"

networks:
  lab:
    ipam:
      config:
        - subnet: 10.0.103.0/24

services:
  # NFS Server
  nfs-server:
    image: itsthenetwork/nfs-server-alpine
    container_name: nfs-server
    hostname: nfs-s
    restart: always
    networks:
      lab:
        ipv4_address: 10.0.103.3    
    ports:
      - 2049:2049
    volumes:
      - ./server/share:/nfsshare
    environment:
      - SHARED_DIRECTORY=/nfsshare
      # - READ_ONLY
      # - PERMITTED="10.0.103.*"
    cap_add:
      - SYS_ADMIN
      - SETPCAP

  nfs-client:
    build: ./client
    container_name: nfs-client
    hostname: nfs-c
    # net: host
    networks:
      lab:
        ipv4_address: 10.0.103.4
    privileged: true
    # restart: always
    # volumes:
      # - /mnt:/nfsshare:shared  
      # - ./demo:/nfsshare:shared   
    environment:
      SERVER: 10.0.103.3
      # - SHARE: 

  # nfs-client:
  #   image: d3fk/nfs-client
  #   container_name: nfs-client
  #   hostname: nfs-c
  #   privileged: true
  #   cap_add:
  #     - SYS_ADMIN
  #     - SETPCAP